当输入一条sql语句后，如何处理呢？首先把数据存储逻辑分离出来，提供一个数据处理的接口；然后业务层逻辑分离出来。接着在这个业务层里，需要搞明白SQL语句的意思，然后决定怎么做，最后是怎么执行。

```
mysql -h 192.168.0.1 -P 8080 -u sa
```

> 连接器

建立和管理连接。TCP握手成功后，对客户端进行身份认证，当连接成功后如果后续没有动作连接会处于空闲状态。此时如果修改登录用户的权限，只有等用户退出重新登录才会使用新的权限。默认的空闲时间是8小时，可以修改：

```
wait_timeout=newval
```

查看当前的连接：

```
show prcocesslist
```

长连接会占用很大的内存，有时会被系统强行删除，对外的表现是数据库异常重启。解决办法一是定期断开连接，到了MySQL 5.7以后可以通过一下初始化连接资源，而不需要重新校验用户权限。

```
mysql_reset_connection
```

> 缓存

如果sql语句执行过，会把sql语句设置成缓存，把查询结果当成value。当然这种缓存适合不大更新的表。还可以显式调用缓存：

```
select SQL_CACHE * from t where Id = 10;
```

> 分析器

如果缓存里没有就来到分析器，会对语法做检查，总之是让MySQL知道客户端需要做什么。

> 优化器

在这里MySQL会寻求做事更好的方法。索引、连接表什么的都会用到。

> 执行器

首先会查看用户有没有操作表的权限，调用数据引擎获取数据。

> 存储引擎

有InnoDB这是默认的，执行器的执行范围可通过：

```
rows_examined
```