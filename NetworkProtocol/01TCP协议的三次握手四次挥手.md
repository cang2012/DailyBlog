>在TCP协议中，首先是有客户端和服务端，它们之间的通讯是双向连接的，这不像HTTP，HTTP是无状态的，需要客户端request，然后服务端再response。而TCP，里面有一个状态机维护着客户端和服务端之间的状态，一旦建立连接，客户端可以向服务端发送消息，反之亦然。

按照常理，本来是有四次握手的。客户端发送一个消息，服务端确认收到消息；服务端发送一个消息，客户端确认收到消息。在这中间，服务端确认收到客户信息再发送信息给客户端，把这两步合并成一步了，所以才有了三次握手。

而用来传输信息的报文导致如下：

```
source port(16bit)
destination port(16bit)
sequnce no.用来维护客户端和服务端之间的状态
acknowledgement no.
check sum
window size
urgent pointer
options
data(options)
flags:URG,ACK,PSH,RST,SYN,FIN
```

**三次握手：**

- 第一次握手：客户端发送SYN，把报文中的而且要给sequence no赋上初值，这个初值有一个专用的名词叫intial sequence number，initial sequence是怎么来的呢？根据一个时钟和32位计数器产生一个随机数。(SYN=1，ACK=0,ISN=1000)
- 第二次握手：服务端发送ACK，并把报文中的ACK=1，客户端确认报文中的SYN和ACK。(SYN=1,ACK=1,ISN=3000,ACK NO=1001)
- 第三次握手：客户端发送SYN,服务端确认(SYN=0,ACK=1,SEQ NO=1001,ACK NO=3001)

以上，客端和服务端初次发送信息的时候，都有一个initial sequence no,而且两者是不一样的。一旦建立连接，每次握手服务端的ACK NO和客户端的ACK NO都有，但不一样；只有第一次握手和第二次握手的时候SYN=1，第三次SYN=0。

**四次挥手**

TCP是双向通讯，要结束连接的时候，双方都必须发送终止信号。

- 第一次挥手：客户端说结束
- 第二次挥手：服务端说知道
- 第三次挥手：服务端说结束
- 第四次挥手：客户端说知道

那么，第二次挥手和第三次挥手为什么不合并呢？因为，在第三次挥手，即服务端说结束的时候，服务端有可能还在接受来自客户端的数据，为了保证接受完整来自客户端的数据，需要让第二次挥手结束掉，再开始第三次挥手。