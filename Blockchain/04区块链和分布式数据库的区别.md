有人把区块链比作分布式数据库，两者有很多的相同点和不同点。

区块链和分布式数据库都有节点，节点之间必须达成共识。对数据库来说共识就是"Two Phase commit",首先写入Write-Ahead Logging(WAL)持久化，再写入状态。

> CQRS, Command Query Responsibility Segeration，是由Martin Fowler提出的，做到事件和状态的分离。

在区块链若干交易由共识算法选择出来的矿工验证，并打包成为区块，随后广播到其它节点验证，最后写入statedb，这是事件和状态分离的做法。

> crash recovery

区块链会找到最近的commit,找到与其一致的区块高度，从这个高度往后一个区块一个区块同步，依次执行区块中的所有交易，最后更新本地状态，达成一致。

而在数据库中，从其它节点同步最新的WAL，从上次的commit开始找到对应的WAL往后一个记录一个记录执行命令。

> 验证

对区块链来说，需要完成身份验证和完整性验证。身份确定钱包中的私钥签名。完整性验证在state db账号下由超过1个ATB的token。而分布式数据库基于Role Based Access Control。

> 确定性

区块是基于共识，是唯一的，也是确定的。如果想在区块中添加额外信息，比如"smart contract"的话，代码方面有一些注意的地方：

- 不使用不确定的随机数
- 避免使用多线程，多线程会导致race condition
- 避免使用系统时钟
- 避免使用未被初始化的内存
- 避免使用浮点数，不同的CPU对浮动数的指令集不一样
- 避免使用随机数据结构，比如map

> 一致性

在区块链中，当前节点把交易执行完成，写入state db,然后给矿工节点发送确认，矿工节点再广播出去，把消息放到read-write lock队列里；而在分布式数据库中，每个节点都有一个snapshot.

> 性能

在区块链中，当节点越多达成共识的难度越大，广播传播的时间也越长。