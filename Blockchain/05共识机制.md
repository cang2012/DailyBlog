当区块链中有很多节点，消息的同步需要有共识机制。这个共识机制需要做两件事：一个是谁有权力记账，一个是防止节点作弊。所谓的作弊就是一个节点发送给其它节点的信息不一样，或者篡改信息，在比特币中就是防止"双花(double spending)"的出现。比较常用的共识机制是PoW(Proof of Work)。

谁有权力记账呢？共识机制会出一个问题，比如算24点，谁拥有的计算资源多，谁就拥有更大概率的记账权。而当节点的记账概率超过50%时候，这个节点就有可能成为决定因素，成为中心化的节点。

如何避免节点记账概率超过50%呢？或者说如何防止节点作弊呢？


1. 一方面通过降低答案产生的速度。
2. 最最重要的一个理念是：

```
篡改收入<诚实记账的收入
```

而

```
篡改收入=篡改账本获得的受益-投入计算资源耗掉的成本
```

在比特币的共识机制中大致是这样：当一个节点拥有整个系统30%的资源，获得连续6次记账的概率是万分之七。花费如此大的成本获得记账概率如此小，这种篡改就不划算了。

以上，一个是控制节点产生的速度，一个是降低记账概率，还有就是从标记transaction来避免作弊。

当一个代币已经被花费，就把这个transaction标记为已花费，广播出去，如果节点再次收到这个代币的花费请求，节点就拒绝打包。

> 共识机制做了这么几件事：控制节点的产生速度，让节点即使得到记账的概率相对高但作弊收益少，防止代笔的双花。